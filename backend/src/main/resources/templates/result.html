<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
  <body>
    <h1>Result</h1>
    <p>GPX uploaded successfully</p>
    <p>Name: <span th:text="${gpx.name}" /></p>
    <p>Description: <span th:text="${gpx.description}" /></p>
    <p>Elevation Gain: <span th:text="${gpx.elevationGain}" /> m</p>
    <p>Elevation Loss: <span th:text="${gpx.elevationLoss}" /> m</p>
    <p>Distance: <span th:text="${gpx.distance}" /> m</p>
    <p>Hills:</p>
    <ul>
      <li th:each="hill : ${gpx.hills}" th:text="${hill.gain + ' m'}"></li>
    </ul>
    <div id="threejs-container" style="width: 600px; height: 400px"></div>
    <script th:inline="javascript">
      /*<![CDATA[*/
      const gpx = [[${gpx}]];
      console.log(gpx);
      /*]]>*/
    </script>
    <script type="module">
      import * as THREE from "./packages/threeJS/three.module.js";
      import { OrbitControls } from "./packages/threeJS/OrbitControls.js";

      // Hooray for some dude on YouTube
      // https://www.youtube.com/watch?v=nwiaqLGAyjo&t=12s&ab_channel=WaelYasmina

      // Set up scene, camera, renderer
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, 600 / 400, 0.1, 100000);
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(600, 400);
      document
        .getElementById("threejs-container")
        .appendChild(renderer.domElement);

      const controls = new OrbitControls(camera, renderer.domElement);

      // Path
      const points = gpx.trackPointsCartesian.map(
        (point) => new THREE.Vector3(point.x, point.y, point.z)
      );

      console.log("Point count:", points.length);
      const path = new THREE.CatmullRomCurve3(points);
      // const pathGeometry = new THREE.BufferGeometry().setFromPoints(
      //   path.getPoints(points.length - 1)
      // );
      // const pathMaterial = new THREE.LineBasicMaterial({ color: 0x00ff00 });
      // const pathMesh = new THREE.Line(pathGeometry, pathMaterial);
      // scene.add(pathMesh);

      const pathGeometry = new THREE.BufferGeometry().setFromPoints(points);
      const pathMaterial = new THREE.LineBasicMaterial({ color: 0x00ff00 });
      const pathMesh = new THREE.Line(pathGeometry, pathMaterial);
      scene.add(pathMesh);

      camera.position.z = 3;

      function animate() {
        requestAnimationFrame(animate);
        // pathMesh.rotation.x += 0.01;
        // pathMesh.rotation.y += 0.01;
        controls.update();
        renderer.render(scene, camera);
      }
      animate();
    </script>
  </body>
</html>
